rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    match /users/{userId} {
      allow read, update: if request.auth.uid == userId;
      allow create: if request.auth.uid != null;
      
      match /messages/{messageId} {
        allow read, write: if request.auth.uid == userId;
      }
      
      match /plans/{planId} {
      	allow read, write: if request.auth.uid == userId;
      }
      
      match /journals/{entryId} {
        allow read, write: if request.auth.uid == userId;
      }
      
      match /armors/{armorId} {
      	allow read, write: if request.auth.uid == userId;
      }
    }
    
    match /sharedArmors/{armorId} {
    	allow read: if request.auth != null;
    }

    match /congregations/{congregationId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      
      match /members/{memberId} {
      	allow read, write, delete: if request.auth != null;
      }
      
      match /posts/{postId} {
        allow read, create;
        allow update: if request.auth.uid == resource.data.authorId;
        
        match /comments/{commentId} {
        	allow read, create;
          allow update, delete: if request.auth.uid == resource.data.authorId;
        }
        
        match /likes/{likeId} {
        	allow read, write: if request.auth.uid == likeId;
        }
      }
    }
    
    match /notifications/{notificationId} {
      allow read, update: if request.auth.uid == resource.data.recipientId;
    }
    
    match /userPushTokens/{userId} {
    	allow read, write: if request.auth.uid == userId;
    }
    
    match /sharedContent/{contentId} {
      // Anyone can read a shared content page
      allow read;
      // Only authenticated users can create
      allow create: if request.auth != null;
      // Only the creator can update/delete (though we don't have this UI yet)
      allow update, delete: if request.auth.uid == resource.data.creatorId;
    }
    
    match /prayerCircles/{circleId} {
    	allow read: if request.auth != null;
      allow create, update: if request.auth != null;
    }

    match /victories/{victoryId} {
      allow read;
      allow create: if request.auth != null;
      allow update: if request.auth != null;
    }

  }
}
